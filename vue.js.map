{"version":3,"file":"vue.js","sources":["src/integrations/vue.js","src/util.js"],"sourcesContent":["let Vue;\nimport { mapActions } from '../util';\n\nexport function install(_Vue) {\n\tif (Vue === _Vue) {\n\t\tthrow Error('[unistore] already installed.');\n\t}\n\tVue = _Vue;\n\tVue.mixin({\n\t\tbeforeCreate() {\n\t\t\tconst options = this.$options;\n\t\t\t// store injection\n\t\t\tif (options.store) {\n\t\t\t\tthis.$store = typeof options.store === 'function'\n\t\t\t\t  ? options.store()\n\t\t\t\t  : options.store;\n\t\t\t  }\n\t\t\telse if (options.parent && options.parent.$store) {\n\t\t\t\tthis.$store = options.parent.$store;\n\t\t\t  }\n\t\t}\n\t});\n}\n\nfunction getAttrs(component) {\n\treturn component._self.$options._parentVnode.data.attrs;\n}\n\nfunction getStates(component, mapStateToProps) {\n\tconst store = component.$store;\n\tconst attrs = {};\n\n\treturn mapStateToProps(store.getState(), attrs) || {};\n}\n\n\nfunction getProps(component) {\n\tlet props = {};\n\tconst attrs = getAttrs(component);\n\tconst stateNames = component.stateNames || [];\n\tconst actionNames = component.actionNames || [];\n\n\tfor (let ii = 0; ii < stateNames.length; ii++) {\n\t  props[stateNames[ii]] = component[stateNames[ii]];\n\t}\n\n\tfor (let ii = 0; ii < actionNames.length; ii++) {\n\t  props[actionNames[ii]] = component[actionNames[ii]];\n\t}\n\n\treturn {\n\t  ...props,\n\t  ...attrs\n\t};\n}\n\nexport function connect(mapStateToProps, actions) {\n\treturn children => Vue.extend({\n\t\tname: `connected-${children.name || 'children'}`,\n\t\tdata() {\n\t\t\tconst store = this.$store;\n\t\t\tconst state = getStates(this, mapStateToProps);\n\t\t\tconst stateNames = Object.keys(state);\n\t\t\tconst boundActions = actions ? mapActions(actions, store) : { store };\n\n\t\t\tconst actionNames = Object.keys(boundActions);\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...boundActions,\n\t\t\t\tstateNames,\n\t\t\t\tactionNames\n\t\t\t};\n\t\t},\n\t\tcreated() {\n\t\t\tthis.unistoreUnsubscribe = this.$store.subscribe(() => {\n\t\t\t\tconst state = getStates(this, mapStateToProps);\n\t\t\t\tconst stateNames = Object.keys(state);\n\t\t\t\tthis.stateNames = stateNames;\n\t\t\t\tfor (let ii = 0; ii < stateNames.length; ii++) {\n\t\t\t\t\tthis[stateNames[ii]] = state[stateNames[ii]];\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\trender(h) {\n\t\t\tconst props = getProps(this);\n\t\t\treturn h(children, { props });\n\t\t},\n\t\tbeforeDestroy() {\n\t\t\tthis.unistoreUnsubscribe();\n\t\t}\n\t});\n}\n","// Bind an object/factory of actions to the store and wrap them.\nexport function mapActions(actions, store) {\n\tif (typeof actions==='function') actions = actions(store);\n\tlet mapped = {};\n\tfor (let i in actions) {\n\t\tmapped[i] = store.action(actions[i]);\n\t}\n\treturn mapped;\n}\n\n\n// select('foo,bar') creates a function of the form: ({ foo, bar }) => ({ foo, bar })\nexport function select(properties) {\n\tif (typeof properties==='string') properties = properties.split(/\\s*,\\s*/);\n\treturn state => {\n\t\tlet selected = {};\n\t\tfor (let i=0; i<properties.length; i++) {\n\t\t\tselected[properties[i]] = state[properties[i]];\n\t\t}\n\t\treturn selected;\n\t};\n}\n\n\n// Lighter Object.assign stand-in\nexport function assign(obj, props) {\n\tfor (let i in props) obj[i] = props[i];\n\treturn obj;\n}\n"],"names":["let","Vue","getStates","component","mapStateToProps","$store","getState","_Vue","Error","mixin","beforeCreate","const","options","this","$options","store","parent","actions","children","extend","name","data","state","stateNames","Object","keys","boundActions","mapped","i","action","mapActions","actionNames","created","unistoreUnsubscribe","subscribe","ii","length","render","h","props","attrs","_self","_parentVnode","getAttrs","getProps","beforeDestroy"],"mappings":"AAAAA,IAAIC,EA4BJ,SAASC,EAAUC,EAAWC,GAI7B,OAAOA,EAHOD,EAAUE,OAGKC,mCA/B9B,SAEwBC,GACvB,GAAIN,IAAQM,EACX,MAAMC,MAAM,kCAEbP,EAAMM,GACFE,OACHC,wBACCC,IAAMC,EAAUC,KAAKC,SAEjBF,EAAQG,MACXF,KAAKR,OAAkC,mBAAlBO,EAAQG,MACzBH,EAAQG,QACRH,EAAQG,MAEJH,EAAQI,QAAUJ,EAAQI,OAAOX,SACzCQ,KAAKR,OAASO,EAAQI,OAAOX,4BAsCjC,SAAwBD,EAAiBa,GACxC,gBAAOC,UAAYjB,EAAIkB,QACtBC,mBAAmBF,EAASE,MAAQ,YACpCC,gBACCV,IAAMI,EAAQF,KAAKR,OACbiB,EAAQpB,EAAUW,KAAMT,GACxBmB,EAAaC,OAAOC,KAAKH,GACzBI,EAAeT,EC9DjB,SAAoBA,EAASF,GACd,mBAAVE,IAAsBA,EAAUA,EAAQF,IACnDf,IAAI2B,KACJ,IAAK3B,IAAI4B,KAAKX,EACbU,EAAOC,GAAKb,EAAMc,OAAOZ,EAAQW,IAElC,OAAOD,EDwD0BG,CAAWb,EAASF,UAAWA,GAExDgB,EAAcP,OAAOC,KAAKC,GAEhC,OAAOF,iBACHF,EACHI,cACAH,cACAQ,KAGFC,8BACCnB,KAAKoB,oBAAsBpB,KAAKR,OAAO6B,qBACtCvB,IAAMW,EAAQpB,EAAUW,EAAMT,GACxBmB,EAAaC,OAAOC,KAAKH,GAC/BT,EAAKU,WAAaA,EAClB,IAAKvB,IAAImC,EAAK,EAAGA,EAAKZ,EAAWa,OAAQD,IACxCtB,EAAKU,EAAWY,IAAOb,EAAMC,EAAWY,OAI3CE,gBAAOC,GACN3B,IAAM4B,EAjDT,SAAkBpC,GAMjB,IALAH,IAAIuC,KACEC,EAdP,SAAkBrC,GACjB,OAAOA,EAAUsC,MAAM3B,SAAS4B,aAAarB,KAAKmB,MAapCG,CAASxC,GACjBoB,EAAapB,EAAUoB,eACvBQ,EAAc5B,EAAU4B,gBAErBI,EAAK,EAAGA,EAAKZ,EAAWa,OAAQD,IACvCI,EAAMhB,EAAWY,IAAOhC,EAAUoB,EAAWY,IAG/C,IAAKnC,IAAImC,EAAK,EAAGA,EAAKJ,EAAYK,OAAQD,IACxCI,EAAMR,EAAYI,IAAOhC,EAAU4B,EAAYI,IAGjD,OAAOX,iBACFe,EACHC,GAiCcI,CAAS/B,MACvB,OAAOyB,EAAEpB,SAAYqB,KAEtBM,yBACChC,KAAKoB"}